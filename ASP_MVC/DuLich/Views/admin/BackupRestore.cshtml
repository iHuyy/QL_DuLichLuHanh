@model DuLich.Models.BackupRestoreViewModel
@{
    ViewData["Title"] = "Sao lưu và Phục hồi Dữ liệu";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <!-- Page-Title -->
    <div class="row">
        <div class="col-sm-12">
            <div class="page-title-box">
                <div class="float-right">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "Admin")">Admin</a></li>
                        <li class="breadcrumb-item active">Sao lưu & Phục hồi</li>
                    </ol>
                </div>
                <h4 class="page-title">Sao lưu và Phục hồi Cơ sở dữ liệu</h4>
            </div><!--end page-title-box-->
        </div><!--end col-->
    </div>
    <!-- end page title end breadcrumb -->

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">
            @TempData["Success"]
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">
            @TempData["Error"]
        </div>
    }

    <div class="row">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-body">
                    <h4 class="mt-0 header-title">Sao lưu Thủ công</h4>
                    <p class="text-muted mb-3">
                        Nhấn nút bên dưới để tạo một bản sao lưu ngay lập tức cho toàn bộ schema của ứng dụng.
                        File sao lưu sẽ được lưu vào thư mục đã cấu hình trên máy chủ cơ sở dữ liệu.
                        Tên file sẽ có dạng <code>TADMIN_BACKUP_YYYYMMDD_HH24MISS.dmp</code>.
                    </p>
                    <form asp-action="CreateBackup" asp-controller="BackupRestore" method="post">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Bắt đầu Sao lưu ngay
                        </button>
                    </form>
                </div><!--end card-body-->
            </div><!--end card-->
        </div> <!-- end col -->

        <div class="col-lg-6">
            <div class="card">
                <div class="card-body">
                    <h4 class="mt-0 header-title">Phục hồi từ Sao lưu</h4>
                    <p class="text-muted mb-3">
                        Chọn một file <code>.dmp</code> từ danh sách bên dưới để phục hồi.
                        <strong>Cảnh báo:</strong> Hành động này sẽ ghi đè toàn bộ dữ liệu hiện tại trong schema bằng dữ liệu từ file sao lưu.
                    </p>
                    <form asp-action="RestoreBackup" asp-controller="BackupRestore" method="post">
                        @Html.AntiForgeryToken()
                        <div class="form-group">
                            <label for="BackupFileName">Chọn file sao lưu để phục hồi</label>
                            @if (Model.BackupFiles != null && Model.BackupFiles.Any())
                            {
                                <select asp-for="BackupFileName" class="form-control">
                                    <option value="">-- Chọn một file --</option>
                                    @foreach (var backupFile in Model.BackupFiles)
                                    {
                                        <option value="@backupFile">@backupFile</option>
                                    }
                                </select>
                                <span asp-validation-for="BackupFileName" class="text-danger"></span>
                            }
                            else
                            {
                                <p class="form-control-static text-warning">Không tìm thấy file sao lưu nào trong thư mục cấu hình.</p>
                            }
                        </div>

                        @if (Model.BackupFiles != null && Model.BackupFiles.Any())
                        {
                            <button type="submit" class="btn btn-danger" onclick="return confirm('Bạn có chắc chắn muốn phục hồi cơ sở dữ liệu từ file này không? Mọi dữ liệu hiện tại sẽ bị ghi đè.');">
                                <i class="fas fa-upload"></i> Bắt đầu Phục hồi
                            </button>
                        }
                        else
                        {
                            <button type="submit" class="btn btn-danger" disabled>
                                <i class="fas fa-upload"></i> Bắt đầu Phục hồi
                            </button>
                        }
                    </form>
                </div><!--end card-body-->
            </div><!--end card-->
        </div> <!-- end col -->
    </div><!--end row-->

</div><!-- container -->
