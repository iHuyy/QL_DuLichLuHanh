@model IEnumerable<DuLich.Models.NhanVien>
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="row page-titles mx-0">
    <div class="col-sm-6 p-md-0">
        <div class="welcome-text">
            <h4>Danh sách nhân viên</h4>
        </div>
    </div>
    <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-controller="Admin" asp-action="Dashboard">Home</a></li>
            <li class="breadcrumb-item active">Staffs</li>
        </ol>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <div class="mb-3">
                    <a class="btn btn-primary" href="/Admin/CreateUser?role=NhanVien">
                        <i class="fa fa-plus"></i> Thêm nhân viên mới
                    </a>
                </div>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>ORACLE_USERNAME</th>
                        <th>Họ tên</th>
                        <th>Email</th>
                        <th>SĐT</th>
                        <th>Chi nhánh</th>
                        <th>Vai trò</th>
                        <th>Trạng thái</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var u in Model)
                    {
                        <tr>
                            <td>@u.MaNhanVien</td>
                            <td>@u.ORACLE_USERNAME</td>
                            <td>@u.HoTen</td>
                            <td>@u.Email</td>
                            <td>@u.SoDienThoai</td>
                            <td>
                                <form method="post" action="/Admin/ChangeStaffBranch" style="display:inline-block;">
                                    <input type="hidden" name="id" value="@u.MaNhanVien" />
                                    <select name="maChiNhanh" class="form-control form-control-sm" onchange="this.form.submit()">
                                        @foreach (var chiNhanh in (List<ChiNhanh>)ViewBag.ChiNhanhs)
                                        {
                                            if (u.MaChiNhanh == chiNhanh.MaChiNhanh)
                                            {
                                                <option value="@chiNhanh.MaChiNhanh" selected>@chiNhanh.TenChiNhanh</option>
                                            }
                                            else
                                            {
                                                <option value="@chiNhanh.MaChiNhanh">@chiNhanh.TenChiNhanh</option>
                                            }
                                        }
                                    </select>
                                </form>
                            </td>
                            <td>
                                <form method="post" action="/Admin/ChangeStaffRole" style="display:inline-block;">
                                    <input type="hidden" name="id" value="@u.MaNhanVien" />
                                    <select name="vaiTro" class="form-control form-control-sm" onchange="this.form.submit()">
                                        @foreach (var role in (List<string>)ViewBag.Roles)
                                        {
                                            if (u.VaiTro == role)
                                            {
                                                <option value="@role" selected>@role</option>
                                            }
                                            else
                                            {
                                                <option value="@role">@role</option>
                                            }
                                        }
                                    </select>
                                </form>
                            </td>
                            <td>@u.TrangThai</td>
                            <td>
                                <a class="btn btn-sm btn-primary" href="/Admin/EditStaff?id=@u.MaNhanVien">
                                    <i class="fa fa-edit"></i> Sửa
                                </a>
                                <form method="post" action="/Admin/DeleteStaff" 
                                    onsubmit="return confirm('Xác nhận xóa nhân viên này? Hành động này không thể hoàn tác.')"
                                    style="display:inline-block;margin-left:6px">
                                    <input type="hidden" name="username" value="@u.ORACLE_USERNAME" />
                                    <button type="submit" class="btn btn-sm btn-danger">
                                        <i class="fa fa-trash"></i> Xóa
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>